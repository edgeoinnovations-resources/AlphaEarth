<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaEarth Satellite Embeddings Viewer</title>

    <!-- MapLibre GL JS for 3D Globe -->
    <script src="https://unpkg.com/maplibre-gl@4.1.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@4.1.0/dist/maplibre-gl.css" rel="stylesheet" />

    <!-- Google Earth Engine API -->
    <script src="https://cdn.jsdelivr.net/npm/@google/earthengine@1.2.0/build/ee_api_js.js"></script>

    <!-- Mapbox GL Draw for polygon drawing -->
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" type="text/css" />

    <!-- Custom styles -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Script load error handling -->
    <script>
        window.eeLoadError = false;
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'SCRIPT' && e.target.src.includes('earthengine')) {
                window.eeLoadError = true;
                console.error('Failed to load Earth Engine API from:', e.target.src);
            }
        }, true);
    </script>
</head>
<body>
    <!-- Map Container -->
    <div id="map"></div>

    <!-- Control Panel (matching the screenshot UI) -->
    <div id="control-panel">
        <div class="panel-section">
            <div class="panel-header">
                <span class="panel-icon">&#9674;</span>
                <span>Layers</span>
                <button class="panel-toggle" id="layers-toggle">&#8963;</button>
            </div>
            <div class="layer-controls" id="layers-content">
                <label class="layer-item">
                    <input type="checkbox" id="toggle-all" checked>
                    <span>All layers on/off</span>
                </label>
                <label class="layer-item">
                    <input type="checkbox" id="layer-background" checked>
                    <span>background</span>
                    <input type="range" class="opacity-slider" id="opacity-background" min="0" max="100" value="100">
                </label>
                <label class="layer-item">
                    <input type="checkbox" id="layer-imagery" checked>
                    <span>USGS.Imagery</span>
                    <input type="range" class="opacity-slider" id="opacity-imagery" min="0" max="100" value="100">
                </label>
                <label class="layer-item">
                    <input type="checkbox" id="layer-embeddings" checked>
                    <span id="embeddings-layer-name">Embeddings 2020</span>
                    <input type="range" class="opacity-slider" id="opacity-embeddings" min="0" max="100" value="100">
                </label>
            </div>
        </div>

        <div class="panel-section">
            <div class="panel-header">
                <span class="panel-icon">&#9881;</span>
                <span>AlphaEarth</span>
                <button class="panel-toggle" id="alphaearth-toggle">&#8963;</button>
            </div>
            <div class="alphaearth-controls" id="alphaearth-content">
                <div class="control-row">
                    <label>Year:</label>
                    <input type="range" id="year-slider" min="2017" max="2024" value="2020" step="1">
                    <span id="year-value">2020</span>
                </div>

                <div class="control-row band-selectors">
                    <label>Red:</label>
                    <select id="band-red"></select>
                    <label>Green:</label>
                    <select id="band-green"></select>
                    <label>Blue:</label>
                    <select id="band-blue"></select>
                </div>

                <div class="control-row">
                    <label>Min:</label>
                    <input type="range" id="min-slider" min="-1" max="0" value="-0.3" step="0.05">
                    <label>Max:</label>
                    <input type="range" id="max-slider" min="0" max="1" value="0.3" step="0.05">
                </div>
                <div class="control-row">
                    <span id="minmax-value">-0.30 to 0.30</span>
                </div>

                <div class="control-row">
                    <label>Terrain exaggeration:</label>
                    <input type="range" id="terrain-slider" min="0" max="5" value="2" step="0.1">
                    <span id="terrain-value">2.00</span>
                </div>

                <div class="control-row checkbox-row">
                    <label>
                        <input type="checkbox" id="labels-toggle" checked>
                        Add labels on top
                    </label>
                </div>

                <div class="control-row">
                    <label>Layer Name:</label>
                    <input type="text" id="layer-name" value="Embeddings 2020">
                </div>

                <div class="button-row">
                    <button id="btn-apply" class="btn btn-primary">Apply</button>
                    <button id="btn-reset" class="btn btn-secondary">Reset</button>
                    <button id="btn-close" class="btn btn-danger">Close</button>
                </div>
            </div>
        </div>

        <!-- Case Studies Panel Section -->
        <div class="panel-section" id="case-studies-panel">
            <div class="panel-header">
                <span class="panel-icon">ðŸ“š</span>
                <span>Case Studies</span>
                <span id="mode-indicator" class="mode-indicator"></span>
                <button class="panel-toggle" id="case-studies-toggle">&#8963;</button>
            </div>
            <div class="case-studies-controls" id="case-studies-content">
                <div class="control-row">
                    <select id="category-filter" class="category-select"></select>
                </div>
                <div class="control-row">
                    <input type="text" id="scenario-search" placeholder="Search scenarios..." class="search-input">
                </div>
                <div id="scenario-list" class="scenario-list"></div>
                <div id="scenario-detail" class="scenario-detail" style="display: none;">
                    <div id="detail-content"></div>
                    <div class="detail-actions">
                        <button id="btn-back" class="btn btn-secondary">Back</button>
                        <button id="btn-explore" class="btn btn-primary">Explore</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <h2>Google Earth Engine Authentication</h2>
            <p>To view AlphaEarth satellite embeddings, you need to authenticate with Google Earth Engine.</p>
            <p><strong>Prerequisites:</strong></p>
            <ul>
                <li>A Google account</li>
                <li>Earth Engine access (sign up at <a href="https://earthengine.google.com" target="_blank">earthengine.google.com</a>)</li>
            </ul>
            <button id="btn-authenticate" class="btn btn-primary btn-large">Authenticate with Google</button>
            <p class="note">Note: Authentication opens a popup window. Please allow popups for this site.</p>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="hidden">
        <div class="spinner"></div>
        <p>Loading AlphaEarth embeddings...</p>
    </div>

    <!-- Attribution -->
    <div id="attribution">
        <span>AlphaEarth dataset by Google & Google DeepMind</span>
        <span class="separator">|</span>
        <a href="https://github.com/edgeoinnovations-resources/AlphaEarth" target="_blank">GitHub</a>
    </div>

    <!-- Explainer Box -->
    <div id="explainer-box" class="explainer-box hidden">
        <div class="explainer-header">
            <span class="explainer-icon">ðŸ’¡</span>
            <span>What am I looking at?</span>
            <button class="explainer-close" onclick="CaseStudiesUI.hideExplainer()">Ã—</button>
        </div>
        <p id="explainer-text"></p>
    </div>

    <!-- Show Explainer Button -->
    <button id="show-explainer-btn" class="show-explainer-btn hidden" onclick="CaseStudiesUI.showExplainer()">
        ðŸ’¡ Show Explainer
    </button>

    <!-- Scripts -->
    <script src="js/earth-engine.js"></script>
    <script src="js/ui-controls.js"></script>
    <script src="js/case-studies.js"></script>
    <script src="js/case-studies-ui.js"></script>
    <script src="js/app.js"></script>

    <!-- AI Chatbot Widget -->
    <button id="ae-chat-toggle">ðŸ¤– Ask AI</button>
    <div id="ae-chatbot-container">
        <div id="ae-chat-header">
            <span>AlphaEarth Guide</span>
            <button id="ae-chat-close">Ã—</button>
        </div>
        <div id="ae-chat-messages">
            <div class="ae-message bot">Hello! I can explain the satellite data or specific case studies.</div>
        </div>
        <div id="ae-chat-input-area">
            <input type="text" id="ae-chat-input" placeholder="Ask about this area...">
            <button id="ae-chat-send">âž¤</button>
        </div>
    </div>
    <script type="module" src="js/chatbot-logic.js"></script>
</body>
</html>
